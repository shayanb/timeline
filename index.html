<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>⏳ Interactive Timeline</title>
  <!-- Minimal emoji favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14' font-size='16'>⏳</text></svg>">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <!-- Component-specific CSS files -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/timeline.css">
  <link rel="stylesheet" href="css/forms.css">
  <link rel="stylesheet" href="css/controls.css">
</head>
<body class="bg-gray-50">
  <div id="app" class="container mx-auto px-4 py-8 max-w-7xl">
    <header class="bg-white p-4 rounded-md shadow-sm mb-6">
      <h1 class="text-2xl font-bold text-center text-gray-800">
        <span class="inline-block mr-2">⏳</span>Interactive Timeline
      </h1>
      <div id="timeline-header" class="flex justify-center mt-2">
        <div id="current-month-display" class="text-lg font-medium text-gray-600"></div>
      </div>
    </header>

    <div class="controls-container bg-white p-3 rounded-md shadow-sm mb-6">
      <div class="left-controls">
        <button id="add-event-btn" class="ui primary button">
          <i class="plus icon"></i> Add Event
        </button>
      </div>
      <div class="right-controls">
        <div class="ui compact buttons">
          <button type="button" id="import-help-btn" class="ui small compact circular icon button" title="AI Import Help" style="margin-right: 8px;">
            <i class="info circle icon"></i>
          </button>
          <button type="button" id="import-btn" class="ui small compact icon button">
            <i class="upload icon"></i>
            Import
          </button>
          <div class="ui small compact floating dropdown icon button" id="export-dropdown">
            <i class="download icon"></i>
            Export
            <div class="menu">
              <div class="item" id="export-yaml">YAML</div>
              <div class="item" id="export-csv">CSV</div>
              <div class="item" id="export-png">PNG Image</div>
            </div>
          </div>
          <button type="button" id="clear-all-btn" class="ui small compact icon button red" title="Clear All Data">
            <i class="trash icon"></i>
            Clear All
          </button>
          <span id="modification-status" class="ui small yellow label" style="display: none;">MODIFIED</span>
        </div>
        <input type="file" id="import-file" accept=".yaml,.yml,.csv" hidden>
      </div>
    </div>

    <section id="form-container" class="bg-white p-3 rounded-md shadow-sm transition-all">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-semibold" id="form-title">Add New Event</h3>
        <button type="button" id="close-form-btn" class="text-gray-500 hover:text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
      
      <form id="event-form" class="ui form">
        <!-- Minimalist form with no section boxes -->
        <div class="field">
          <label for="title">Title</label>
          <input type="text" id="title" placeholder="Title" required>
        </div>
        
        <div class="two fields">
          <div class="field">
            <label for="start-date">Start Date</label>
            <input type="date" id="start-date" required>
          </div>
          <div class="field">
            <label for="end-date">End Date</label>
            <input type="date" id="end-date" required>
          </div>
        </div>
        
        <div class="two fields">
          <div class="field">
            <label for="event-type">Type</label>
            <select id="event-type" class="ui dropdown">
              <option value="range">Range Event</option>
              <option value="life">Life Event</option>
              <option value="milestone">Milestone</option>
            </select>
          </div>
          <div class="field">
            <label for="category">Category</label>
            <div class="ui search selection dropdown" id="category-dropdown">
              <input type="hidden" id="category">
              <i class="dropdown icon"></i>
              <div class="default text">Category</div>
              <div class="menu" id="category-menu">
                <div class="item" data-value="">None</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="two fields">
          <div class="field">
            <label for="color">Color</label>
            <input type="color" id="color" value="#1f77b4">
          </div>
          <div class="field" id="row-field" style="display: none;">
            <label for="event-row">Row</label>
            <select id="event-row" class="ui compact dropdown">
              <!-- Options will be populated by JavaScript -->
            </select>
          </div>
        </div>
        
        <div class="field">
          <div class="ui checkbox">
            <input type="checkbox" id="important">
            <label for="important">Mark as important</label>
          </div>
        </div>
        
        <div class="two fields">
          <div class="field">
            <label for="parent-event">Parent Event</label>
            <div class="ui action input">
              <select id="parent-event" class="ui compact dropdown">
                <option value="">None</option>
              </select>
              <button type="button" id="remove-parent-btn" class="ui mini icon button" style="display: none;">
                <i class="x icon"></i>
              </button>
            </div>
          </div>
          <div class="field">
            <div class="ui checkbox">
              <input type="checkbox" id="is-parent">
              <label for="is-parent">Mark as parent event</label>
            </div>
          </div>
        </div>
        
        <div class="field">
          <label for="event-id">Event ID</label>
          <input type="text" id="event-id" placeholder="unique-id">
        </div>
        
        <div class="two fields">
          <div class="field">
            <label for="city">City</label>
            <input type="text" id="city" placeholder="City">
          </div>
          <div class="field">
            <label for="country">Country</label>
            <div class="ui search selection dropdown" id="country-dropdown">
              <input type="hidden" id="country">
              <i class="dropdown icon"></i>
              <div class="default text">Country</div>
              <div class="menu" id="country-menu"></div>
            </div>
          </div>
        </div>
        
        <div class="field">
          <label for="metadata">Notes</label>
          <input type="text" id="metadata" placeholder="Additional details">
        </div>
        
        <!-- Action Buttons - Refactored -->
        <div class="action-buttons-container">
          <button type="submit" id="submit-btn" class="ui button primary">Save</button>
          <button type="button" id="delete-btn" class="ui button negative" style="display: none;">Delete</button>
          <button type="button" id="cancel-btn" class="ui button">Cancel</button>
        </div>
      </form>
    </section>

    <section id="timeline-container" class="bg-white rounded-md shadow-sm overflow-hidden">
      <div class="timeline-header bg-gray-50 border-b border-gray-200 h-10 flex items-center">
        <div class="w-[180px] border-r border-gray-200 px-4">
          <span class="text-sm font-medium text-gray-700">Categories</span>
        </div>
        <div id="timeline-months" class="flex flex-1"></div>
      </div>
      <div id="timeline" class="relative"></div>
      <div id="tooltip" class="tooltip"></div>
    </section>

    <section id="charts-container" class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-white p-4 rounded-md shadow-sm">
        <h3 class="text-lg font-semibold mb-3">Places Heatmap</h3>
        <div id="world-heatmap"></div>
      </div>
      <div class="bg-white p-4 rounded-md shadow-sm">
        <h3 class="text-lg font-semibold mb-3">Places & Categories</h3>
        <div id="nested-pie-chart"></div>
      </div>
    </section>
    
    <footer class="mt-6 bg-white p-4 rounded-md shadow-sm">
      <div class="flex flex-col items-center space-y-3">
        <div class="flex items-center space-x-6 text-sm text-gray-600">
          <a href="https://x.com/sbetamc" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-1 text-blue-500 hover:text-blue-700 transition-colors">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
            <span>sbetamc</span>
          </a>
          <a href="https://github.com/shayanb/timeline" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-1 text-blue-500 hover:text-blue-700 transition-colors">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
            <span>GitHub</span>
          </a>
          <a href="https://buymeacoffee.com/pangana" target="_blank" rel="noopener noreferrer" class="flex items-center space-x-1 text-orange-500 hover:text-orange-700 transition-colors">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M2 21h19v-3H2v3zm1.5-6h1c.8 0 1.5-.7 1.5-1.5v-6c0-.8-.7-1.5-1.5-1.5h-1c-.8 0-1.5.7-1.5 1.5v6c0 .8.7 1.5 1.5 1.5zM20.5 3H9c-.8 0-1.5.7-1.5 1.5v10c0 .8.7 1.5 1.5 1.5h11.5c.8 0 1.5-.7 1.5-1.5v-10c0-.8-.7-1.5-1.5-1.5zm-1 9.5c0 .8-.7 1.5-1.5 1.5H9V5h9.5v7.5z"/>
            </svg>
            <span>Buy me a coffee</span>
          </a>
        </div>
        <div class="flex items-center justify-between w-full text-xs text-gray-500">
          <div class="version-info">
            <span id="app-version"></span>
          </div>
          <div class="modification-status" id="footer-modification-status"></div>
          <div class="copyright">
            <span id="app-copyright"></span>
            <a href="#" id="run-tests" style="display: none; margin-left: 10px; font-size: 0.8em; color: #888;">[Run Tests]</a>
          </div>
        </div>
      </div>
      <div id="import-stats" class="ui small message mt-2" style="display: none;">
        <div class="content">
          <p id="import-stats-text"></p>
        </div>
      </div>
    </footer>
  </div>

  <!-- AI Import Help Modal -->
  <div class="ui large modal" id="ai-import-help-modal">
    <i class="close icon"></i>
    <div class="header">
      <i class="robot icon"></i>
      AI-Assisted CSV Generation
    </div>
    <div class="scrolling content">
      <div class="ui container">
        <h3>How to Use AI (ChatGPT/Claude) to Create Timeline Data</h3>
        <p>You can use AI tools to convert your natural language stories into properly formatted CSV data for import.</p>
        
        <div class="ui three stackable steps">
          <div class="step">
            <i class="edit icon"></i>
            <div class="content">
              <div class="title">Tell Your Story</div>
              <div class="description">Write your story in natural language</div>
            </div>
          </div>
          <div class="step">
            <i class="copy icon"></i>
            <div class="content">
              <div class="title">Use the Prompt</div>
              <div class="description">Copy the prompt below with your story</div>
            </div>
          </div>
          <div class="step">
            <i class="download icon"></i>
            <div class="content">
              <div class="title">Import Result</div>
              <div class="description">Save CSV output and import it here</div>
            </div>
          </div>
        </div>

        <div class="ui divider"></div>
        <div class="ui two column stackable grid" style="margin-top: 20px;">
        <div class="column">
            <h2>Example Story Input:</h2>
            <div class="ui secondary segment">
              <p style="font-style: italic; font-size: 0.9em; line-height: 1.4;">
                "I graduated from UC Berkeley with a Computer Science degree in May 2020. During my time there from 2016-2020, I did an internship at Google in summer 2019 in Mountain View, and another at Microsoft in Seattle during summer 2018. After graduation, I started working at Meta in Menlo Park in August 2020. I got promoted to Senior Engineer in January 2022. I also traveled to Japan for vacation in March 2021 and to Europe (France, Italy, Germany) in summer 2022."
              </p>
            </div>
          </div>

          <div class="column">
            <div class="ui info message">
              <div class="header">Tips for Better Results:</div>
              <ul class="ui list">
                <li>Be specific about dates and timeframes</li>
                <li>Mention locations clearly</li>
                <li>Group related events by mentioning categories</li>
                <li>Indicate which events are most important</li>
                <li>Describe relationships between events</li>
              </ul>
            </div>
          </div>

        </div>
        <h3>Copy-Paste Prompt for AI</h3>
        <div class="ui segment" style="background-color: #f8f9fa; position: relative;">
          <button class="ui right floated mini primary button" id="copy-prompt-btn" style="position: absolute; top: 10px; right: 10px; z-index: 10;">
            <i class="copy icon"></i>
            Copy Prompt
          </button>
          <div class="ui top attached label">Prompt for ChatGPT/Claude</div>
          <div id="ai-prompt-text" style="font-family: 'Courier New', monospace; white-space: pre-wrap; font-size: 0.85em; line-height: 1.5; padding-top: 30px; word-wrap: break-word; overflow-wrap: break-word;">Please convert the following story into a CSV format for a timeline application. Use this exact header format and follow these guidelines:

**CSV Header (use exactly):**
title,start,end,type,category,color,isImportant,isParent,parent_id,event_id,location_city,location_country,metadata,row

**Guidelines:**
- **title**: Event name/description
- **start**: Start date in YYYY-MM-DD format
- **end**: End date in YYYY-MM-DD format (same as start for single-day events)
- **type**: Use "range" for events with duration (jobs, education periods), "life" for major life events (graduation, marriage, moves, births, deaths), "milestone" for single moments (promotions, awards)
- **category**: Group related events (e.g., "Education", "Career", "Travel", "Personal")
- **color**: Hex color code (e.g., #1f77b4) or leave empty for auto-assignment
- **isImportant**: true/false - mark significant events
- **isParent**: true/false - true if this event has sub-events
- **parent_id**: ID of parent event if this is a sub-event, empty otherwise
- **event_id**: Unique identifier for this event (e.g., edu_001, career_002)
- **location_city**: City where event occurred
- **location_country**: Country where event occurred
- **metadata**: Additional notes or details
- **row**: Leave empty for auto-placement, or specify number for manual row assignment

**Default Values:**
- If dates are unclear, ask me to clarify
- If location is mentioned but not specific, put general location in country field
- If duration isn't clear, make it a single-day event (start = end)
- Use meaningful event_id values that group related events
- Create parent-child relationships for related events (e.g., "University Studies" as parent, individual courses as children)

**My Story:**
[PASTE YOUR STORY HERE]

Please ask clarifying questions if any important details are missing, then provide the CSV output ready for copy and also import (actual .csv file).</div>
        </div>


      </div>
    </div>
    <div class="actions">
      <div class="ui cancel button">Close</div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <!-- PDF Export removed -->
  <script type="module" src="script.js"></script>
</body>
</html>